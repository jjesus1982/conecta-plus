# ============================================
# Conecta Plus - PostgreSQL Replica Configuration
# Hot Standby Mode
# ============================================

# -----------------------------
# CONNECTION SETTINGS
# -----------------------------
listen_addresses = '*'
port = 5432
max_connections = 200

# -----------------------------
# REPLICA/STANDBY SETTINGS
# -----------------------------
# hot_standby permite queries de leitura na replica
hot_standby = on
hot_standby_feedback = on

# Tempo maximo de espera por queries no standby (em ms)
# -1 = sem limite
max_standby_streaming_delay = 30s
max_standby_archive_delay = 30s

# Cancela queries que bloqueiam recuperacao por muito tempo
# wal_receiver_status_interval = 10s

# -----------------------------
# REPLICATION SETTINGS
# -----------------------------
# Configurado via postgresql.auto.conf pelo pg_basebackup
# primary_conninfo = 'host=postgres port=5432 user=replicator password=xxx'
# primary_slot_name = 'replica_slot'

# Tentativas de reconexao
wal_receiver_timeout = 60s

# -----------------------------
# MEMORY SETTINGS
# (Pode ser menor que o master para replicas de leitura)
# -----------------------------
shared_buffers = 128MB
effective_cache_size = 384MB
maintenance_work_mem = 32MB
work_mem = 8MB

# -----------------------------
# WAL SETTINGS
# Replica precisa ter max_wal_senders >= master para recovery
# -----------------------------
wal_level = replica
max_wal_senders = 3
max_replication_slots = 3
wal_keep_size = 32MB

# -----------------------------
# LOGGING
# -----------------------------
logging_collector = on
log_directory = 'log'
log_filename = 'postgresql-replica-%Y-%m-%d.log'
log_rotation_age = 1d
log_rotation_size = 100MB
log_min_messages = info
log_min_error_statement = error
log_statement = 'ddl'

# Log de conexoes de replicacao
log_replication_commands = on

# -----------------------------
# LOCALE
# Alpine nao tem pt_BR.UTF-8, usar C.UTF-8
# -----------------------------
lc_messages = 'C'
lc_monetary = 'C'
lc_numeric = 'C'
lc_time = 'C'
timezone = 'America/Sao_Paulo'

# -----------------------------
# PERFORMANCE (LEITURA)
# Otimizado para queries de leitura
# -----------------------------
random_page_cost = 1.1
effective_io_concurrency = 200
default_statistics_target = 100
